<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>Nginxçš„ç«™ç‚¹é…ç½®/PHP-FPMé…ç½® :: Whidy Daily â€” Here is Whidy&#39;s github note, you will find somethings here.</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="2018å¹´3æœˆ22æ—¥ æ™´ ä¸€èˆ¬
 Nginxçš„ç«™ç‚¹é…ç½®/PHP-FPMé…ç½® 22å·æ˜¯è‰°éš¾çš„ä¸€å¤©. å„ç§çˆ†ç‚¸!
Nginxçš„ç«™ç‚¹é…ç½®  æ˜¨æ™š, å›å»çœ‹äº†ä¸€ä¸‹ç™¾åº¦ç»Ÿè®¡, ä¸€ä¸‹å­å°±ç‚¸äº†. åœ¨æˆ‘è¿˜ä¸äº†è§£Nginxé…ç½®çš„æƒ…å†µä¸‹, æˆ‘åªæ˜¯è®©é¦–é¡µæ­£å¸¸è®¿é—®äº†&amp;hellip; å…¶ä»–é¡µé¢å…¨æŒ‚. äºæ˜¯å¼€å§‹äº†å¤§é‡è‹±æ–‡èµ„æ–™çš„é˜…è¯».
 ä»¥ä¸‹å†…å®¹å›´ç»•nginx.confé…ç½®æ–‡ä»¶å±•å¼€, ä¹Ÿä¸çŸ¥é“æ˜¯ä¸æ˜¯ç‰ˆæœ¬åŒºåˆ«, æ€»è·Ÿç½‘ä¸Šçš„æ–‡ç« æœ‰äº›ä¸ä¸€æ ·, æˆ‘ä¹Ÿé™·å…¥è¿·èŒ«.
æˆ‘è¦è§£å†³çš„é—®é¢˜:
 åšå®¢æ‰€æœ‰é¡µé¢(åŒ…æ‹¬æ–‡ç« ä¼ªé™æ€)è®¿é—®æ­£å¸¸; å…¶ä»–åŸŸå(whidy.net, whidy.cn, www.whidy.cn)å‡éœ€è¦301è½¬å‘åˆ°www.whidy.net, é¿å…åˆ†æƒ é’ˆå¯¹wordpressçš„ç›¸å…³ä¼˜åŒ–(å¯é€‰)  é‚£ä¹ˆ, åŸºäºNginxå¯¹æœåŠ¡å™¨çš„ç®¡ç†çš„ç ”ç©¶, æˆ‘å‘ç°å…¶ä¸»è¦é’ˆå¯¹ä¸åŒçš„ç«™ç‚¹è¿›è¡ŒServer Blocké…ç½®, è€ŒServer Blockå¦‚ä½•ç®¡ç†, æˆ‘æŸ¥äº†å¤§é‡èµ„æ–™, æ¯”å¦‚è¿™é‡Œæœ‰ä¸€ç¯‡æ–‡ç« æ‘˜è¦
 To begin, we will need to set up the directory that our server blocks will be stored in, as well as the directory that tells Nginx that a server block is ready to serve to visitors."/>
<meta name="keywords" content="whidy daily blog"/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="/daily/2018-03-22-nginx-phpfpm/" />


<link rel="stylesheet" href="/assets/style.css">



<link rel="stylesheet" href="/style.css">


<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/apple-touch-icon-144-precomposed.png">

<link rel="shortcut icon" href="/img/favicon/orange.png">



<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Nginxçš„ç«™ç‚¹é…ç½®/PHP-FPMé…ç½® :: Whidy Daily â€” Here is Whidy&#39;s github note, you will find somethings here." />
<meta name="twitter:description" content="2018å¹´3æœˆ22æ—¥ æ™´ ä¸€èˆ¬
 Nginxçš„ç«™ç‚¹é…ç½®/PHP-FPMé…ç½® 22å·æ˜¯è‰°éš¾çš„ä¸€å¤©. å„ç§çˆ†ç‚¸!
Nginxçš„ç«™ç‚¹é…ç½®  æ˜¨æ™š, å›å»çœ‹äº†ä¸€ä¸‹ç™¾åº¦ç»Ÿè®¡, ä¸€ä¸‹å­å°±ç‚¸äº†. åœ¨æˆ‘è¿˜ä¸äº†è§£Nginxé…ç½®çš„æƒ…å†µä¸‹, æˆ‘åªæ˜¯è®©é¦–é¡µæ­£å¸¸è®¿é—®äº†&amp;hellip; å…¶ä»–é¡µé¢å…¨æŒ‚. äºæ˜¯å¼€å§‹äº†å¤§é‡è‹±æ–‡èµ„æ–™çš„é˜…è¯».
 ä»¥ä¸‹å†…å®¹å›´ç»•nginx.confé…ç½®æ–‡ä»¶å±•å¼€, ä¹Ÿä¸çŸ¥é“æ˜¯ä¸æ˜¯ç‰ˆæœ¬åŒºåˆ«, æ€»è·Ÿç½‘ä¸Šçš„æ–‡ç« æœ‰äº›ä¸ä¸€æ ·, æˆ‘ä¹Ÿé™·å…¥è¿·èŒ«.
æˆ‘è¦è§£å†³çš„é—®é¢˜:
 åšå®¢æ‰€æœ‰é¡µé¢(åŒ…æ‹¬æ–‡ç« ä¼ªé™æ€)è®¿é—®æ­£å¸¸; å…¶ä»–åŸŸå(whidy.net, whidy.cn, www.whidy.cn)å‡éœ€è¦301è½¬å‘åˆ°www.whidy.net, é¿å…åˆ†æƒ é’ˆå¯¹wordpressçš„ç›¸å…³ä¼˜åŒ–(å¯é€‰)  é‚£ä¹ˆ, åŸºäºNginxå¯¹æœåŠ¡å™¨çš„ç®¡ç†çš„ç ”ç©¶, æˆ‘å‘ç°å…¶ä¸»è¦é’ˆå¯¹ä¸åŒçš„ç«™ç‚¹è¿›è¡ŒServer Blocké…ç½®, è€ŒServer Blockå¦‚ä½•ç®¡ç†, æˆ‘æŸ¥äº†å¤§é‡èµ„æ–™, æ¯”å¦‚è¿™é‡Œæœ‰ä¸€ç¯‡æ–‡ç« æ‘˜è¦
 To begin, we will need to set up the directory that our server blocks will be stored in, as well as the directory that tells Nginx that a server block is ready to serve to visitors." />
<meta name="twitter:site" content="/" />
<meta name="twitter:creator" content="whidy" />
<meta name="twitter:image" content="">


<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Nginxçš„ç«™ç‚¹é…ç½®/PHP-FPMé…ç½® :: Whidy Daily â€” Here is Whidy&#39;s github note, you will find somethings here.">
<meta property="og:description" content="2018å¹´3æœˆ22æ—¥ æ™´ ä¸€èˆ¬
 Nginxçš„ç«™ç‚¹é…ç½®/PHP-FPMé…ç½® 22å·æ˜¯è‰°éš¾çš„ä¸€å¤©. å„ç§çˆ†ç‚¸!
Nginxçš„ç«™ç‚¹é…ç½®  æ˜¨æ™š, å›å»çœ‹äº†ä¸€ä¸‹ç™¾åº¦ç»Ÿè®¡, ä¸€ä¸‹å­å°±ç‚¸äº†. åœ¨æˆ‘è¿˜ä¸äº†è§£Nginxé…ç½®çš„æƒ…å†µä¸‹, æˆ‘åªæ˜¯è®©é¦–é¡µæ­£å¸¸è®¿é—®äº†&amp;hellip; å…¶ä»–é¡µé¢å…¨æŒ‚. äºæ˜¯å¼€å§‹äº†å¤§é‡è‹±æ–‡èµ„æ–™çš„é˜…è¯».
 ä»¥ä¸‹å†…å®¹å›´ç»•nginx.confé…ç½®æ–‡ä»¶å±•å¼€, ä¹Ÿä¸çŸ¥é“æ˜¯ä¸æ˜¯ç‰ˆæœ¬åŒºåˆ«, æ€»è·Ÿç½‘ä¸Šçš„æ–‡ç« æœ‰äº›ä¸ä¸€æ ·, æˆ‘ä¹Ÿé™·å…¥è¿·èŒ«.
æˆ‘è¦è§£å†³çš„é—®é¢˜:
 åšå®¢æ‰€æœ‰é¡µé¢(åŒ…æ‹¬æ–‡ç« ä¼ªé™æ€)è®¿é—®æ­£å¸¸; å…¶ä»–åŸŸå(whidy.net, whidy.cn, www.whidy.cn)å‡éœ€è¦301è½¬å‘åˆ°www.whidy.net, é¿å…åˆ†æƒ é’ˆå¯¹wordpressçš„ç›¸å…³ä¼˜åŒ–(å¯é€‰)  é‚£ä¹ˆ, åŸºäºNginxå¯¹æœåŠ¡å™¨çš„ç®¡ç†çš„ç ”ç©¶, æˆ‘å‘ç°å…¶ä¸»è¦é’ˆå¯¹ä¸åŒçš„ç«™ç‚¹è¿›è¡ŒServer Blocké…ç½®, è€ŒServer Blockå¦‚ä½•ç®¡ç†, æˆ‘æŸ¥äº†å¤§é‡èµ„æ–™, æ¯”å¦‚è¿™é‡Œæœ‰ä¸€ç¯‡æ–‡ç« æ‘˜è¦
 To begin, we will need to set up the directory that our server blocks will be stored in, as well as the directory that tells Nginx that a server block is ready to serve to visitors." />
<meta property="og:url" content="/daily/2018-03-22-nginx-phpfpm/" />
<meta property="og:site_name" content="Nginxçš„ç«™ç‚¹é…ç½®/PHP-FPMé…ç½®" />
<meta property="og:image" content="">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

<meta property="article:published_time" content="2018-03-22 00:00:00 &#43;0000 UTC" />











</head>
<body class="">


<div class="container">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/">
  <div class="logo">
    Daily Note
  </div>
</a>

    </div>
    <div class="menu-trigger">menu</div>
  </div>
  
    <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/daily">DailyğŸ“’</a></li>
        
      
        
          <li><a href="/post">PostğŸ˜</a></li>
        
      
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/daily">DailyğŸ“’</a></li>
      
    
      
        <li><a href="/post">PostğŸ˜</a></li>
      
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
  <div class="post">
    <h1 class="post-title"><a href="/daily/2018-03-22-nginx-phpfpm/">Nginxçš„ç«™ç‚¹é…ç½®/PHP-FPMé…ç½®</a></h1>
    <div class="post-meta">
      <span class="post-date">
        2018-03-22
      </span>
      <span class="post-author">:: whidy</span>
    </div>

    

    

    <div class="post-content">
      

<blockquote>
<p>2018å¹´3æœˆ22æ—¥ æ™´ ä¸€èˆ¬</p>
</blockquote>

<h1 id="nginxçš„ç«™ç‚¹é…ç½®-php-fpmé…ç½®">Nginxçš„ç«™ç‚¹é…ç½®/PHP-FPMé…ç½®</h1>

<p>22å·æ˜¯è‰°éš¾çš„ä¸€å¤©. å„ç§çˆ†ç‚¸!</p>

<h2 id="nginxçš„ç«™ç‚¹é…ç½®">Nginxçš„ç«™ç‚¹é…ç½®</h2>

<blockquote>
<p>æ˜¨æ™š, å›å»çœ‹äº†ä¸€ä¸‹ç™¾åº¦ç»Ÿè®¡, ä¸€ä¸‹å­å°±ç‚¸äº†. åœ¨æˆ‘è¿˜ä¸äº†è§£Nginxé…ç½®çš„æƒ…å†µä¸‹, æˆ‘åªæ˜¯è®©é¦–é¡µæ­£å¸¸è®¿é—®äº†&hellip; å…¶ä»–é¡µé¢å…¨æŒ‚. äºæ˜¯å¼€å§‹äº†å¤§é‡è‹±æ–‡èµ„æ–™çš„é˜…è¯».</p>
</blockquote>

<p>ä»¥ä¸‹å†…å®¹å›´ç»•<code>nginx.conf</code>é…ç½®æ–‡ä»¶å±•å¼€, ä¹Ÿä¸çŸ¥é“æ˜¯ä¸æ˜¯ç‰ˆæœ¬åŒºåˆ«, æ€»è·Ÿç½‘ä¸Šçš„æ–‡ç« æœ‰äº›ä¸ä¸€æ ·, æˆ‘ä¹Ÿé™·å…¥è¿·èŒ«.</p>

<p>æˆ‘è¦è§£å†³çš„é—®é¢˜:</p>

<ol>
<li>åšå®¢æ‰€æœ‰é¡µé¢(åŒ…æ‹¬æ–‡ç« ä¼ªé™æ€)è®¿é—®æ­£å¸¸;</li>
<li>å…¶ä»–åŸŸå(<code>whidy.net</code>, <code>whidy.cn</code>, <code>www.whidy.cn</code>)å‡éœ€è¦<strong>301è½¬å‘</strong>åˆ°<code>www.whidy.net</code>, é¿å…åˆ†æƒ</li>
<li>é’ˆå¯¹<code>wordpress</code>çš„ç›¸å…³ä¼˜åŒ–(å¯é€‰)</li>
</ol>

<p>é‚£ä¹ˆ, åŸºäº<code>Nginx</code>å¯¹æœåŠ¡å™¨çš„ç®¡ç†çš„ç ”ç©¶, æˆ‘å‘ç°å…¶ä¸»è¦é’ˆå¯¹ä¸åŒçš„ç«™ç‚¹è¿›è¡Œ<code>Server Block</code>é…ç½®, è€Œ<code>Server Block</code>å¦‚ä½•ç®¡ç†, æˆ‘æŸ¥äº†å¤§é‡èµ„æ–™, æ¯”å¦‚è¿™é‡Œæœ‰ä¸€ç¯‡æ–‡ç« æ‘˜è¦</p>

<blockquote>
<p>To begin, we will need to set up the directory that our server blocks will be stored in, as well as the directory that tells Nginx that a server block is ready to serve to visitors. The <code>sites-available</code> directory will keep all of our server block files, while the <code>sites-enabled</code> directory will hold symbolic links to server blocks that we want to publish.</p>
</blockquote>

<p>å‚é˜…: <a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-nginx-server-blocks-on-centos-7">How To Set Up Nginx Server Blocks on CentOS 7</a></p>

<p>ç®€å•æ¥è¯´, ä»–å»ºè®®åœ¨Nginxé…ç½®ç®¡ç†ç›®å½•ä¸‹åˆ›å»ºä¸¤ä¸ªç›®å½•, <code>sites-available</code>æ˜¯ç”¨äºå­˜æ”¾å¯ç”¨çš„ç«™ç‚¹é…ç½®, <code>sites-enabled</code>åˆ™æ˜¯å­˜æ”¾<code>sites-available</code>å†…çš„é…ç½®è½¯é“¾æ¥è¿‡æ¥çš„, å°†è¦ç”Ÿæ•ˆåœ¨<code>nginx.conf</code>ä¸­</p>

<p>å…ˆä»‹ç»ä¸‹æƒ…å†µ, æˆ‘çš„<code>wordpress</code>ä½äº<code>/var/www/</code>ç›®å½•ä¸‹, é‚£ä¹ˆæ•´ä¸ªæµç¨‹å¦‚ä¸‹:</p>

<p>åˆ›å»ºåˆšæåˆ°çš„ä¸¤ä¸ªå­˜æ”¾ç«™ç‚¹é…ç½®çš„ç›®å½•</p>

<pre><code class="language-bash"># mkdir /etc/nginx/sites-available
# mkdir /etc/nginx/sites-enabled
</code></pre>

<p>ä¿®æ”¹<code>nginx.conf</code>ä½¿åˆšåˆ›å»ºçš„ç›®å½•å†…çš„é…ç½®ç”Ÿæ•ˆ</p>

<pre><code class="language-bash"># nano /etc/nginx/nginx.conf
</code></pre>

<p>åœ¨<code>http{}</code>å—å†…å°¾éƒ¨æ·»åŠ </p>

<pre><code class="language-text">include /etc/nginx/sites-enabled/*.conf;
server_names_hash_bucket_size 64;
</code></pre>

<p>åˆ›å»º<code>wordpress.conf</code>é…ç½®æ–‡ä»¶åœ¨<code>sites-available</code>å†…</p>

<pre><code class="language-bash"># vi /etc/nginx/sites-available/word press.conf
</code></pre>

<p>ç¼–è¾‘å†…å®¹å¤§è‡´å¦‚ä¸‹:</p>

<pre><code class="language-text">server {
    server_name www.whidy.net;
    root /var/www/wordpress;
    index index.php index.html index.htm;

    include /etc/nginx/default.d/*.conf;

    location = /favicon.ico {
        log_not_found off;
        access_log off;
    }

    location = /robots.txt {
        allow all;
        log_not_found off;
        access_log off;
    }

    location / {
        try_files $uri $uri/ /index.php?$args;

        if ($http_host ~* &quot;^(www.)?whidy.cn$&quot;){
            rewrite ^(.*)$ https://www.whidy.net/$1 permanent;
        }
        if ($http_host ~* &quot;^whidy.net$&quot;){
            rewrite ^(.*)$ https://www.whidy.net/$1 permanent;
        }
    }

    location ~* \.(js|css|png|jpg|jpeg|gif|ico)$ {
        expires max;
        log_not_found off;
    }

    location ~ /\.ht {
        deny  all;
    }

    gzip on;
    gzip_vary on;
    gzip_comp_level 2;
    gzip_types text/plain text/html text/css application/json application/x-javascript text/xml application/xml application/xml+rss text/javascript application/javascript;
    gzip_proxied any;
    gzip_min_length 1024;
}
</code></pre>

<p>ä¿å­˜å¥½å, è¿˜æœ‰ä»¶äº‹æƒ…å°±æ˜¯æŠŠ<code>nginx.conf</code>æ–‡ä»¶å†…çš„é»˜è®¤<code>server block</code>æ³¨é‡Šæ‰, å®ƒä¼šå¯¼è‡´wordpresså†…çš„301è·³è½¬å¤±æ•ˆ. å½“ç„¶æˆ‘è¿™åˆ†é…ç½®çš„å…·ä½“è¯´æ˜å°±ä¸è¯´äº†, ä¸€æ—¶éš¾ä»¥è®²æ˜ç™½, å»ºè®®å¤§å®¶è‡ªè¡Œè°·æ­Œ. ä¹Ÿå¯å‚è€ƒæˆ‘ä¸‹é¢çš„å‚é˜…åˆ—è¡¨.</p>

<p>æ¥ç€è½¯é“¾æ¥åˆ°<code>sites-enabled</code>ä½¿é…ç½®ç”Ÿæ•ˆ, å‘½ä»¤å¦‚ä¸‹</p>

<pre><code class="language-bash"># ln -s /etc/nginx/sites-available/wordpress.conf /etc/nginx/sites-enabled/wordpress.conf
</code></pre>

<p>æœ€å¥½é‡å¯nginxæœåŠ¡</p>

<pre><code class="language-bash"># systemctl restart nginx
</code></pre>

<p>åœ¨æµè§ˆå™¨æµ‹è¯•ä¸€ä¸‹å®Œç¾~</p>

<p>å‚é˜…:</p>

<ul>
<li>Nginxè¯­æ³•: <a href="http://blog.51cto.com/denglz/1341841">http://blog.51cto.com/denglz/1341841</a></li>
<li>ç½‘ç«™è·³è½¬: <a href="https://www.digitalocean.com/community/tutorials/how-to-create-temporary-and-permanent-redirects-with-nginx">https://www.digitalocean.com/community/tutorials/how-to-create-temporary-and-permanent-redirects-with-nginx</a></li>
<li>Nginxé…ç½®å‚è€ƒå­¦ä¹ 

<ul>
<li><a href="https://gist.github.com/MaherSaif/1580998">https://gist.github.com/MaherSaif/1580998</a></li>
<li><a href="https://gist.github.com/kjprince/9496501">https://gist.github.com/kjprince/9496501</a></li>
<li><a href="https://codex.wordpress.org/Nginx">wordpress nginx é…ç½®</a></li>
<li><a href="https://www.nginx.com/resources/wiki/start/topics/recipes/wordpress/">https://www.nginx.com/resources/wiki/start/topics/recipes/wordpress/</a></li>
</ul></li>
<li><a href="https://www.nginx.com/resources/wiki/start/topics/examples/server_blocks/">Server Block Examples</a></li>
</ul>

<p>ä¸è¿‡åå°æ›´æ–°æ’ä»¶æ—¶åˆå‡ºç°äº†ä¹‹å‰å‘ç”Ÿçš„é—®é¢˜: <strong>&ldquo;è¦æ‰§è¡Œè¯·æ±‚çš„æ“ä½œï¼ŒWordPresséœ€è¦è®¿é—®æ‚¨ç½‘é¡µæœåŠ¡å™¨çš„æƒé™ã€‚&rdquo;</strong> - -çŸ¥é“æ˜¯æƒé™é—®é¢˜,å´ä¸çŸ¥é“æ˜¯å“ªä¸ªæƒé™..çªç„¶æƒ³èµ·nginxçš„phpç®¡ç†æ˜¯php-fpm&hellip;</p>

<pre><code class="language-bash"># chown -R php-fpm:php-fpm /var/www/wordpress
</code></pre>

<p>å°±å¥½äº†..</p>

<h3 id="é…ç½®å¦ä¸€ä¸ªç«™ç‚¹">é…ç½®å¦ä¸€ä¸ªç«™ç‚¹</h3>

<p>é¦–å…ˆæˆ‘åˆ›å»ºäº†ä¸€ä¸ª<code>Jekyll</code>ç«™ç‚¹, å®ƒç”Ÿæˆçš„é™æ€ç›®å½•åœ¨<code>/home/whidy/blog/_site</code>çš„æ—¶å€™. è€Œ<code>nginx</code>ç®¡ç†ç½‘ç«™çš„ç›®å½•æ˜¯<code>/var/www/</code>, æˆ‘è¿™é‡Œä¸ºäº†æ–¹ä¾¿ç®¡ç†åˆ›å»ºäº†è½¯è¿æ¥, å¦‚ä¸‹</p>

<pre><code class="language-bash"># ln -s /home/whidy/blog/_site /var/www/blog
</code></pre>

<p>é…ç½®äº†<code>server block</code>, å¦‚ä¸‹</p>

<pre><code class="language-txt">server {
    listen 80;
    server_name test.whidy.net;
    root /var/www/blog;
    index index.html index.htm;

    location / {
    }

    error_page 404 /404.html;
        location = /40x.html {
    }

    error_page 500 502 503 504 /50x.html;
        location = /50x.html {
    }
}
</code></pre>

<p>ç„¶åè®¿é—®ç½‘ç«™å‡ºç°<code>403</code>, æŸ¥äº†å¾ˆå¤šèµ„æ–™, ä¸ç¡®å®šæ˜¯å¦è·Ÿè½¯é“¾æ¥æœ‰å…³, åæ¥æŸ¥å‡ºæ¥äº†, å› ä¸ºæˆ‘å½“å‰è¿è¡Œnginxçš„ç”¨æˆ·æ˜¯<code>nginx</code>(å‘½ä»¤æŸ¥çœ‹: <code>ps -ef | grep nginx</code>), é‚£ä¹ˆ<strong>nginxæ²¡æœ‰æƒé™è®¿é—®ç”¨æˆ·whidyçš„ç›®å½•åŠæ–‡ä»¶</strong>, æœ¬ä»¥ä¸ºç»™<code>_site</code>ç›®å½•è®¾ç½®å¯è¯»å°±è¡Œäº†, ç„¶åè¿˜æ˜¯<code>403</code>, ä¸ºæ­¤æŠ˜è…¾äº†å¾ˆä¹…, æ‰æŸ¥åˆ°åŸæ¥åŒæ—¶è¿˜<strong>éœ€è¦ç»™nginxä¸€ä¸ªå¯è¯»whidyç›®å½•çš„æƒé™</strong>! ä¹Ÿå°±æ˜¯è¯´æ­¤æ—¶å¿…é¡»åŒæ—¶ç»™<code>/home/whidy/blog/_site</code>(åŒ…å«_siteå†…çš„æ‰€æœ‰æ–‡ä»¶)å’Œ<code>/home/whidy</code>ç›®å½•å¯è¯»æƒé™æ‰èƒ½æ­£å¸¸è®¿é—®</p>

<pre><code class="language-bash"># chmod +r -R /home/whidy/blog/_site
# chmod +r /home/whidy
</code></pre>

<p>æ— éœ€é‡å¯NginxæœåŠ¡, åˆ·æ–°é¡µé¢ç„¶åå°±å¥½äº†.</p>

<blockquote>
<p>å¾ˆå¥‡æ€ªçš„æ˜¯, æˆ‘å‡è®¾ç»™blogç›®å½•ä¸è®¾ç½®å…¨éƒ¨å¯è¯», å®ƒç…§æ ·æ­£å¸¸. çœŸæ˜¯è›‹ç–¼~</p>
</blockquote>

<p>ç›¸å…³é˜…è¯»: <a href="https://www.ibm.com/developerworks/cn/linux/l-cn-hardandsymb-links/index.html">ç†è§£ Linux çš„ç¡¬é“¾æ¥ä¸è½¯é“¾æ¥</a></p>

<h2 id="php-fpmé…ç½®">PHP-FPMé…ç½®</h2>

<p>æˆ‘å¾ˆå¥‡æ€ª, éƒ½è¯´<code>Nginx</code>å†…å­˜å ç”¨æ¯”<code>Apache</code>å°‘, å¯æ˜¯è‡ªä»æˆ‘æ¢äº†<code>Nginx</code>å, <code>MariaDB</code>å´©æºƒé—®é¢˜ä¸æ–­, èµ·åˆä»¥ä¸ºæ˜¯<code>MariaDB</code>çš„é—®é¢˜, è¶Šå‘é¢‘ç¹çš„å†…å­˜æš´å¢å¼•èµ·æˆ‘å¯¹å†…å­˜çš„æ³¨æ„, äºæ˜¯çœ‹çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µåå‘ç°, å­˜åœ¨å¤§é‡çš„<code>php-fpm</code>è¿›ç¨‹, è‡³å°‘å ç”¨äº†å‡ ç™¾å…†å†…å­˜.</p>

<p>æŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µ:</p>

<pre><code class="language-bash"># ps -e -o 'pid,comm,args,pcpu,rsz,vsz,stime,user,uid'
</code></pre>

<p>ç„¶åé€šè¿‡æœç´¢<strong>PHP-FPMå†…å­˜å ç”¨</strong>çš„é—®é¢˜, ç½‘ä¸Šä¹Ÿæœ‰å¾ˆå¤š, é»˜è®¤çŠ¶æ€ä¸‹å®ƒä¼šåŠ¨æ€åˆ†é…å¾ˆå¤šå­è¿›ç¨‹, è¿™æœ‰ç¯‡æ–‡ç« ç®€å•ä»‹ç»äº†ä¸€ä¸‹<a href="https://www.jianshu.com/p/9450ab506446">nginx+php-fpmæ¨¡å¼phpå†…å­˜æ³„æ¼æ¢ç©¶</a>, é‚£ä¹ˆè§£å†³å ç”¨å†…å­˜çš„æ–¹æ³•çœ‹æ¥åªæœ‰ä»PHP-FPMé…ç½®æ–‡ä»¶ä¸Šä¸‹æ‰‹äº†.</p>

<p>è°·æ­Œäº†ç›¸å…³èµ„æ–™, ç›®å‰ç»æµ‹è¯•æ¯”è¾ƒå¥½ç”¨çš„æ–¹æ³•å°±æ˜¯ä¿®æ”¹æ–‡ä»¶</p>

<pre><code class="language-bash"># vi /etc/php-fpm.d/www.conf
</code></pre>

<p>æ‰¾åˆ°<code>pm = dynamic</code>(é»˜è®¤å€¼), æ”¹æˆ<code>pm = ondemand</code>, ä»¥åŠ<code>pm.process_idle_timeout = 10s</code>å»æ‰æ³¨é‡Š, ä¿å­˜å¹¶é‡å¯æœåŠ¡</p>

<pre><code class="language-bash"># systemctl restart php-fpm
</code></pre>

<p>ç»è¿‡ä¸¤å¤©çš„è§‚å¯Ÿ, å†…å­˜ä½¿ç”¨ç¨³å®šåœ¨300Mä»¥å†…, æ¯”è¾ƒæ»¡æ„äº†. ä¸è¿‡ä¸ºä»€ä¹ˆä¼šå†…å­˜æº¢å‡ºå‘¢, çœŸæ˜¯ä¸ç¨³å®šå“~</p>

<p>å‚é˜…: <a href="http://linuxbsdos.com/2015/02/17/how-to-reduce-php-fpm-php5-fpm-ram-usage-by-about-50/">How to reduce PHP-FPM (php5-fpm) RAM usage by about 50%</a></p>

<blockquote>
<p>å®Œæˆ22å·çš„æ—¥å¿—ç°åœ¨å·²ç»æ˜¯ 3-23 23:56, æœ€è¿‘å®åœ¨æ˜¯å¤ªå¿™äº†. æ˜¨æ™šå°ç¨‹åºä¸Šçº¿å‡ºBUG, æåˆ°å¿«æ™šä¸Š11ç‚¹æ‰å›å», ä¹Ÿæœ‰äº›ç»éªŒè¦æ€»ç»“. ä»Šå¤©å…ˆåˆ°è¿™å§</p>
</blockquote>

    </div>
    
      <div class="pagination">
        <div class="pagination__title">
          <span class="pagination__title-h">æŸ¥çœ‹å…¶ä»–</span>
          <hr />
        </div>
        <div class="pagination__buttons">
          
            <span class="button previous">
              <a href="/daily/2018-03-26-note/">
                <span class="button__icon">â†</span>
                <span class="button__text">æ—¥å¿—</span>
              </a>
            </span>
          
          
            <span class="button next">
              <a href="/daily/2018-03-21-nginx/">
                <span class="button__text">Wordpressæ”¹ç”¨Nginx</span>
                <span class="button__icon">â†’</span>
              </a>
            </span>
          
        </div>
      </div>
    

    

  </div>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>Â© 2019 Powered by <a href="http://gohugo.io">Hugo</a></span>
        <span>:: Theme made by <a href="https://twitter.com/panr">panr</a></span>
      </div>
    
  </div>
</footer>

<script src="/assets/main.js"></script>
<script src="/assets/prism.js"></script>





  
</div>

</body>
</html>
